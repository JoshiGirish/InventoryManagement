{% load template_helpers %}
<div id="history-pane" class="card bg-light">
<div class="sidebar-menu bg-light">
    <ul style="list-style-type:none;">
      <li class="header-menu border-bottom" style="text-align: center;">
        <span>History</span>
      </li>
      <div id="historydata">
        <div id="eventlist" >
          <ul class="scroller">
            {% for event in dicts %}
              <li>
                <div id="history-card" class="card bg-light" onclick="updateHistoryObject(this)" data-id={{event.objId}} data-route={{lookupRoute|lookup:event.objmodel}}>
                    <h6 class="card-title">{{event.objname}}</h6>
                    <div class="d-flex justify-content-between align-items-center">
                      <h6 class="card-subtitle mb-2 text-muted">{{event.objmodel}} 
                        {% if event.operation == "Create" %}
                          <span class="badge badge-success">{{event.operation}}d</span>
                        {% elif event.operation == "Update" %}
                          <span class="badge badge-primary">{{event.operation}}d</span>
                        {% elif event.operation == "Delete" %}
                          <span class="badge badge-danger">{{event.operation}}d</span>
                        {% endif %}
                      </h6>
                      <h6 class="card-subtitle mb-2 text-muted">{{event.date}}</h6>
                    </div>
                </div>
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </ul>
  </div>
</div>
<script>
  $(document).ready(function(){
    $.ajax({
            url: "{% url 'history' %}",
            data: {},
            dataType:'html',
            success: function(data){
                $('#historydata').html($('#eventlist',data).html())
            }
          });
  })

    // Function for fetching data to be updated using AJAX
      function updateHistoryObject(tag){
          var id = $(tag).data('id');
          var route = $(tag).data("route");
          var baseUrl = document.location.origin;
          var url = baseUrl + route;
          console.log(id);
          console.log(url);
        $.ajax({
            url: url,
            type: 'GET',
            data: {
                'pk': id
            },
            dataType:'html',
            success: function(data){
              $('#data').html($('#updatedData',data).html()); // fetch and update the view
              $('#displayCorousel').removeClass('active'); // if the display corousel is active, de-activate it
              $('#createCorousel').addClass('active'); // set the create corousel as active
            }
        });
      };
</script>
<style>
  #history-card {
    display: inline-block;
    width: 100%;
    text-decoration: none;
    position: relative;
    /* padding: 8px 30px 8px 20px; */
    padding: 8px 8px 8px 8px;
    margin: 1px;
    color: #252525;
    font-family: 'Comfortaa', cursive;
	  list-style-type: none;
    background-color: rgb(255, 255, 255);
    box-shadow: rgba(46, 49, 50, 0.16) 0px 1px 2.94px 0.06px;
    border-color: currentcolor;
    cursor: pointer;
}

.scroller {
    height: 400px;
    overflow: auto;
    scrollbar-width: none;  /* Firefox */
}

</style>
